<!DOCTYPE html>
<html lang="en">
<head>
    <script src="config.js"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Skill Hive</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="css/styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet" />

  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>

  <style>
    html, body {
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      font-family: 'Montserrat', sans-serif;
    }
    main { 
      flex: 1 0 auto; 
      display: flex;
      align-items: center;
      justify-content: center;
    }
    footer { flex-shrink: 0; }
    #tsparticles {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      top: 0;
      left: 0;
    }
    .navbar-brand span {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1.4rem;
    }
    .animated-heading span {
      display: inline-block;
      opacity: 0;
      transform: translateY(20px);
      animation: letterFadeIn 0.5s ease forwards;
    }
    @keyframes letterFadeIn { to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUpFadeIn { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
    .animated-card { animation: slideUpFadeIn 0.7s ease-out forwards; animation-delay: 0.2s; opacity: 0; }
  </style>
</head>

<body data-bs-theme="light">
  <div id="tsparticles"></div>

  <header class="sticky-top">
    <script src="config.js"></script>

    <div class="container d-flex justify-content-between align-items-center py-2">
      <div style="flex: 1 1 0;">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <img src="assets/images/skillhive-logo.png" alt="Skill Hive Logo" width="110" height="70" />
          <span class="ms-2">Skill Hive</span>
        </a>
      </div>
      <div style="flex: 1 1 0;" class="d-flex justify-content-end align-items-center">
        <button id="darkModeToggle" class="btn btn-outline-secondary ms-2" title="Toggle dark mode">
          <i id="themeIcon" data-lucide="moon"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="col-md-6 col-lg-5 col-xl-4 mx-auto">
      <div class="card p-4 animated-card">
        <div class="text-center mb-4">
          <h2 class="animated-heading">Login</h2>
          <p class="text-muted">Welcome back to Skill Hive.</p>
        </div>
        
        <form id="loginForm">
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="email" placeholder="you@example.com" required />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" required />
          </div>
          
          <div id="errorMessage" class="alert alert-danger d-none" role="alert"></div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg mt-3">Login</button>
          </div>
        </form>

        <div class="text-center mt-3">
          <p class="mb-0">Don't have an account? <a href="signup.html">Sign Up</a></p>
        </div>
      </div>
    </div>
  </main>
  <div id="toastContainer"
      class="position-fixed top-0 start-50 translate-middle-x p-3"
      style="z-index: 1055; margin-top: 20px;">
  <div id="loginToast"
        class="toast align-items-center text-white bg-success border-0 text-center shadow-lg"
        role="alert"
        aria-live="assertive"
        aria-atomic="true">
    <div class="d-flex justify-content-center">
      <div class="toast-body" id="toastMessage">Login successful!</div>
    </div>
  </div>
</div>




  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" ></script>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    lucide.createIcons();

    const loginForm = document.getElementById("loginForm");
    const errorMessage = document.getElementById("errorMessage");

    // âœ… Handle login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorMessage.classList.add("d-none");

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const response = await fetch("${API_BASE_URL}/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        const data = await response.json();
        if (!response.ok) throw new Error(data.message || "Invalid credentials");

        // âœ… Save token
        localStorage.setItem("token", data.token);
        
        // --- THIS IS THE FIX ---
        // We MUST save the user object here so other pages (like index.html)
        // can load properly.
        localStorage.setItem("user", JSON.stringify(data.user)); 
        // --- END OF FIX ---

        
        // 1. Show "Welcome back" toast
        showToast(`Welcome, ${data.user.name}!`, "success");

        // 2. Always go to index.html
        // Your profile.html page will handle showing the "Edit Profile" modal
        // if the user is new by fetching the *full* user object.
        setTimeout(() => (window.location.href = "index.html"), 2000); 

      } catch (error) {
        errorMessage.textContent = error.message;
        errorMessage.classList.remove("d-none");
      }
    });

    // --- Heading Animation ---
    const heading = document.querySelector(".animated-heading");
    if (heading) {
      const text = heading.textContent;
      heading.innerHTML = "";
      text.split("").forEach((letter, i) => {
        const span = document.createElement("span");
        span.textContent = letter === " " ? "\u00A0" : letter;
        span.style.animationDelay = `${i * 0.05}s`;
        heading.appendChild(span);
      });
    }

    // --- Theme and Particles ---
    const darkModeToggle = document.getElementById("darkModeToggle");
    const themeIcon = document.getElementById("themeIcon");
    const body = document.body;

    function getThemeColor() {
      // Adjusted to read the CSS variable from Bootstrap
      return getComputedStyle(document.documentElement).getPropertyValue("--bs-primary").trim();
    }

    function loadParticles() {
      // Clear existing particles
      if (window.tsParticles?.dom?.length) {
          window.tsParticles.dom.forEach(d => d.destroy());
      }
      
      const particleColor = getThemeColor() || "#0d6efd"; // Fallback color
      
      tsParticles.load("tsparticles", {
        fpsLimit: 60,
        background: { color: "transparent" },
        particles: {
          number: { value: 100, density: { enable: true, area: 800 } },
          color: { value: particleColor }, // Use the theme color
          shape: { type: "circle" },
          opacity: { value: { min: 0.1, max: 0.6 } },
          size: { value: { min: 1, max: 10 } },
          move: {
            enable: true,
            speed: 1.5,
            direction: "none", 
            random: true,
            straight: false,
            outModes: { default: "out" }, 
          },
        },
        interactivity: {
          events: { onHover: { enable: true, mode: "bubble" }, resize: true },
          modes: { bubble: { distance: 200, duration: 2, opacity: 1, size: 12 } },
        },
        detectRetina: true,
      });
    }

    const setTheme = (isDark) => {
      body.setAttribute("data-bs-theme", isDark ? "dark" : "light");
      themeIcon.setAttribute("data-lucide", isDark ? "sun" : "moon");
      lucide.createIcons();
      localStorage.setItem("darkMode", isDark ? "true" : "false");
      setTimeout(loadParticles, 50); // Reload particles with new color
    };

    const savedTheme = localStorage.getItem("darkMode") === "true";
    setTheme(savedTheme);

    darkModeToggle.addEventListener("click", () => {
      const isCurrentlyDark = body.getAttribute("data-bs-theme") === "dark";
      setTheme(!isCurrentlyDark);
    });
  // âœ… Toast helper function
  function showToast(message, type = "success") {
    const toastEl = document.getElementById("loginToast");
    const toastMsg = document.getElementById("toastMessage");

    // Safety check
    if (!toastEl || !toastMsg) {
      console.error("Toast elements not found in DOM");
      return;
    }

    // Set color based on type
    toastEl.classList.remove("bg-success", "bg-danger", "bg-warning");
    toastEl.classList.add(
      type === "error" ? "bg-danger" : type === "warning" ? "bg-warning" : "bg-success"
    );

    toastMsg.textContent = message;

    const toast = new bootstrap.Toast(toastEl, {
      autohide: true,
      delay: 2000 // auto-hide after 2 seconds
    });

    toast.show();
  }

  
});
  </script>
</body>
</html>
